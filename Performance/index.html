



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="C++ 핵심 가이드라인 한글화 프로젝트">
      
      
        <link rel="canonical" href="http://www.cppkorea.org/CppCoreGuidelines/Performance/">
      
      
        <meta name="author" content="C++ Korea">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.0">
    
    
      
        <title>Performance - C++ 핵심 가이드라인</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.1b62728e.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#3f51b5">
      
    
    
      <script src="../assets/javascripts/modernizr.268332fc.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nanum+Gothic:300,400,400i,700%7CNanum+Gothic+Coding&display=fallback">
        <style>body,input{font-family:"Nanum Gothic","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Nanum Gothic Coding","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="indigo" data-md-color-accent="blue">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#reason" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="http://www.cppkorea.org/CppCoreGuidelines" title="C++ 핵심 가이드라인" class="md-header-nav__button md-logo">
          
            <img src="../images/logo.svg" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              C++ 핵심 가이드라인
            </span>
            <span class="md-header-nav__topic">
              
                Performance
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="http://github.com/CppKorea/CppCoreGuidelines/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    CppKorea/CppCoreGuidelines
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../Introduction/" class="md-tabs__link">
          Introduction
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../References/" class="md-tabs__link">
          References
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../Architecture/" class="md-tabs__link md-tabs__link--active">
          Sections
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../appendix/Modernizing/" class="md-tabs__link">
          Appendix
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="http://www.cppkorea.org/CppCoreGuidelines" title="C++ 핵심 가이드라인" class="md-nav__button md-logo">
      
        <img src="../images/logo.svg" width="48" height="48">
      
    </a>
    C++ 핵심 가이드라인
  </label>
  
    <div class="md-nav__source">
      


  

<a href="http://github.com/CppKorea/CppCoreGuidelines/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    CppKorea/CppCoreGuidelines
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../home/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Introduction
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Introduction
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Introduction/" title="In: 소개" class="md-nav__link">
      <a name="S-introduction"></a>In: 소개
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      References
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        References
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../References/" title="RF: 레퍼런스" class="md-nav__link">
      <a name="S-references"></a>RF: 레퍼런스
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      Sections
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Sections
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Architecture/" title="Architecture" class="md-nav__link">
      Architecture
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Class/" title="Class" class="md-nav__link">
      Class
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Concurrency/" title="Concurrency" class="md-nav__link">
      Concurrency
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Const/" title="Const" class="md-nav__link">
      Const
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../CPL/" title="C-Style" class="md-nav__link">
      C-Style
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Enum/" title="Enum" class="md-nav__link">
      Enum
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Errors/" title="Errors" class="md-nav__link">
      Errors
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Expr/" title="Expr" class="md-nav__link">
      Expr
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Functions/" title="Functions" class="md-nav__link">
      Functions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Glossary/" title="Glossary" class="md-nav__link">
      Glossary
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../GSL/" title="GSL" class="md-nav__link">
      GSL
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Interfaces/" title="Interfaces" class="md-nav__link">
      Interfaces
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Naming/" title="Naming" class="md-nav__link">
      Naming
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Not/" title="Not-Rule" class="md-nav__link">
      Not-Rule
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
    <a href="./" title="Performance" class="md-nav__link md-nav__link--active">
      Performance
    </a>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Philosophy/" title="Philosophy" class="md-nav__link">
      Philosophy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Profile/" title="Profile" class="md-nav__link">
      Profile
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Resource/" title="Resource" class="md-nav__link">
      Resource
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SL/" title="Standard Library" class="md-nav__link">
      Standard Library
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Source/" title="Source" class="md-nav__link">
      Source
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Templates/" title="Templates" class="md-nav__link">
      Templates
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Unclassified/" title="Unclassified" class="md-nav__link">
      Unclassified
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Appendix
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Appendix
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../appendix/Modernizing/" title="Modernizing" class="md-nav__link">
      Modernizing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../appendix/Tools/" title="Tools" class="md-nav__link">
      Tools
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="http://github.com/CppKorea/CppCoreGuidelines/edit/master/docs/Performance.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="per"><a name="S-performance"></a>Per: 성능</h1>
<p>??? should this section be in the main guide???</p>
<p>이 장에서는 높은 성능 또는 지연이 거의 없어야 하는 사람들을 위한 규칙을 포함하고 있다. 
다시 말해 예측 가능한 짧은 시간 안에 작업을 완료하기 위해 가능한 적은 시간과 리소스를 어떻게 사용하는지와 관련된 규칙이다.</p>
<p>규칙들은 (대부분의) 어플리케이션에 필요한 것보다 더 제한적이고 어떻게 보면 거슬릴 수도 있는 것이다.
일반적인 코드에 이러한 것들을 맹목적으로 따라 하지 않기 바란다:
지연을 없애는 목적을 달성하기 위해서는 굉장한 노력이 필요하다.</p>
<p>성능 규칙 요약:</p>
<ul>
<li><a href="#Rper-reason">Per.1: Don't optimize without reason</a></li>
<li><a href="#Rper-Knuth">Per.2: Don't optimize prematurely</a></li>
<li><a href="#Rper-critical">Per.3: Don't optimize something that's not performance critical</a></li>
<li><a href="#Rper-simple">Per.4: Don't assume that complicated code is necessarily faster than simple code</a></li>
<li><a href="#Rper-low">Per.5: Don't assume that low-level code is necessarily faster than high-level code</a></li>
<li><a href="#Rper-measure">Per.6: Don't make claims about performance without measurements</a></li>
<li><a href="#Rper-efficiency">Per.7: Design to enable optimization</a></li>
<li><a href="#Rper-type">Per.10: Rely on the static type system</a></li>
<li><a href="#Rper-Comp">Per.11: Move computation from run time to compile time</a></li>
<li><a href="#Rper-alias">Per.12: Eliminate redundant aliases</a></li>
<li><a href="#Rper-indirect">Per.13: Eliminate redundant indirections</a></li>
<li><a href="#Rper-alloc">Per.14: Minimize the number of allocations and deallocations</a></li>
<li><a href="#Rper-alloc0">Per.15: Do not allocate on a critical branch</a></li>
<li><a href="#Rper-compact">Per.16: Use compact data structures</a></li>
<li><a href="#Rper-struct">Per.17: Declare the most used member of a time-critical struct first</a></li>
<li><a href="#Rper-space">Per.18: Space is time</a></li>
<li><a href="#Rper-access">Per.19: Access memory predictably</a></li>
<li><a href="#Rper-context">Per.30: Avoid context switches on the critical path</a></li>
</ul>
<h3 id="per1"><a name="Rper-reason"></a>Per.1: 이유없이 최적화하지 마라</h3>
<h5 id="reason">Reason</h5>
<p>If there is no need for optimization, the main result of the effort will be more errors and higher maintenance costs.</p>
<h5 id="note">Note</h5>
<p>Some people optimize out of habit or because it's fun.</p>
<p>???</p>
<h3 id="per2"><a name="Rper-Knuth"></a>Per.2: 성급하게 최적화하지 마라</h3>
<h5 id="reason_1">Reason</h5>
<p>Elaborately optimized code is usually larger and harder to change than unoptimized code.</p>
<p>???</p>
<h3 id="per3"><a name="Rper-critical"></a>Per.3: 성능 크리티컬하지 않는 곳에는 최적화를 하지 마라</h3>
<h5 id="reason_2">Reason</h5>
<p>Optimizing a non-performance-critical part of a program has no effect on system performance.</p>
<h5 id="note_1">Note</h5>
<p>If your program spends most of its time waiting for the web or for a human, optimization of in-memory computation is probably useless.</p>
<p>Put another way: If your program spends 4% of its processing time doing
computation A and 40% of its time doing computation B, a 50% improvement on A is
only as impactful as a 5% improvement on B. (If you don't even know how much
time is spent on A or B, see <a href="#Rper-reason">Per.1</a> and <a
href="#Rper-Knuth">Per.2</a>.)</p>
<h3 id="per4"><a name="Rper-simple"></a>Per.4: 복잡한 코드가 간단한 코드보다 빠르다고 추측하지 마라</h3>
<h5 id="reason_3">Reason</h5>
<p>Simple code can be very fast. Optimizers sometimes do marvels with simple code</p>
<h5 id="example-good">Example, good</h5>
<div class="codehilite"><pre><span></span>    <span class="c1">// clear expression of intent, fast execution</span>

    <span class="n">vector</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">(</span><span class="mi">100000</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span><span class="o">&amp;</span> <span class="nl">c</span> <span class="p">:</span> <span class="n">v</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="o">~</span><span class="n">c</span><span class="p">;</span>
</pre></div>


<h5 id="example-bad">Example, bad</h5>
<div class="codehilite"><pre><span></span>    <span class="c1">// intended to be faster, but is actually slower</span>

    <span class="n">vector</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">(</span><span class="mi">100000</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span> <span class="o">+=</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">uint64_t</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="kt">uint64_t</span><span class="o">&amp;</span> <span class="n">quad_word</span> <span class="o">=</span> <span class="o">*</span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="kt">uint64_t</span><span class="o">*&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
        <span class="n">quad_word</span> <span class="o">=</span> <span class="o">~</span><span class="n">quad_word</span><span class="p">;</span>
    <span class="p">}</span>
</pre></div>


<h5 id="note_2">Note</h5>
<p>???</p>
<p>???</p>
<h3 id="per5"><a name="Rper-low"></a>Per.5: 저수준 코드가 고수준 코드보다 필연적으로 빠를 것이라고 추측하지 마라</h3>
<h5 id="reason_4">Reason</h5>
<p>Low-level code sometimes inhibits optimizations. Optimizers sometimes do marvels with high-level code.</p>
<h5 id="note_3">Note</h5>
<p>???</p>
<p>???</p>
<h3 id="per6"><a name="Rper-measure"></a>Per.6: 측정없이 성능 개선을 주장하지 마라</h3>
<h5 id="reason_5">Reason</h5>
<p>The field of performance is littered with myth and bogus folklore.
Modern hardware and optimizers defy naive assumptions; even experts are regularly surprised.</p>
<h5 id="note_4">Note</h5>
<p>Getting good performance measurements can be hard and require specialized tools.</p>
<h5 id="note_5">Note</h5>
<p>A few simple microbenchmarks using Unix <code>time</code> or the standard-library <code>&lt;chrono&gt;</code> can help dispel the most obvious myths.
If you can't measure your complete system accurately, at least try to measure a few of your key operations and algorithms.
A profiler can help tell you which parts of your system are performance critical.
Often, you will be surprised.</p>
<p>???</p>
<h3 id="per7"><a name="Rper-efficiency"></a>Per.7: 최적화가 가능하게 설계하라</h3>
<h5 id="reason_6">Reason</h5>
<p>Because we often need to optimize the initial design.
Because a design that ignore the possibility of later improvement is hard to change.</p>
<h5 id="example">Example</h5>
<p>From the C (and C++) standard:</p>
<div class="codehilite"><pre><span></span>    <span class="kt">void</span> <span class="nf">qsort</span> <span class="p">(</span><span class="kt">void</span><span class="o">*</span> <span class="n">base</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">num</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">size</span><span class="p">,</span> <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">compar</span><span class="p">)(</span><span class="k">const</span> <span class="kt">void</span><span class="o">*</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span><span class="o">*</span><span class="p">));</span>
</pre></div>


<p>When did you even want to sort memory?
Really, we sort sequences of elements, typically stored in containers.
A call to <code>qsort</code> throws away much useful information (e.g., the element type), forces the user to repeat information
already known (e.g., the element size), and forces the user to write extra code (e.g., a function to compare <code>double</code>s).
This implies added work for the programmer, is error-prone, and deprives the compiler of information needed for optimization.</p>
<div class="codehilite"><pre><span></span>    <span class="kt">double</span> <span class="n">data</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
    <span class="c1">// ... fill a ...</span>

    <span class="c1">// 100 chunks of memory of sizeof(double) starting at</span>
    <span class="c1">// address data using the order defined by compare_doubles</span>
    <span class="n">qsort</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="p">),</span> <span class="n">compare_doubles</span><span class="p">);</span>
</pre></div>


<p>From the point of view of interface design is that <code>qsort</code> throws away useful information.</p>
<p>We can do better (in C++98)</p>
<div class="codehilite"><pre><span></span>    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">Iter</span><span class="o">&gt;</span>
        <span class="kt">void</span> <span class="n">sort</span><span class="p">(</span><span class="n">Iter</span> <span class="n">b</span><span class="p">,</span> <span class="n">Iter</span> <span class="n">e</span><span class="p">);</span>  <span class="c1">// sort [b:e)</span>

    <span class="n">sort</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data</span> <span class="o">+</span> <span class="mi">100</span><span class="p">);</span>
</pre></div>


<p>Here, we use the compiler's knowledge about the size of the array, the type of elements, and how to compare <code>double</code>s.</p>
<p>With C++11 plus <a href="#SS-concepts">concepts</a>, we can do better still</p>
<div class="codehilite"><pre><span></span>    <span class="c1">// Sortable specifies that c must be a</span>
    <span class="c1">// random-access sequence of elements comparable with &lt;</span>
    <span class="kt">void</span> <span class="nf">sort</span><span class="p">(</span><span class="n">Sortable</span><span class="o">&amp;</span> <span class="n">c</span><span class="p">);</span>

    <span class="n">sort</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
</pre></div>


<p>The key is to pass sufficient information for a good implementation to be chosen.
In this, the <code>sort</code> interfaces shown here still have a weakness:
They implicitly rely on the element type having less-than (<code>&lt;</code>) defined.
To complete the interface, we need a second version that accepts a comparison criteria:</p>
<div class="codehilite"><pre><span></span>    <span class="c1">// compare elements of c using p</span>
    <span class="kt">void</span> <span class="nf">sort</span><span class="p">(</span><span class="n">Sortable</span><span class="o">&amp;</span> <span class="n">c</span><span class="p">,</span> <span class="n">Predicate</span><span class="o">&lt;</span><span class="n">Value_type</span><span class="o">&lt;</span><span class="n">Sortable</span><span class="o">&gt;&gt;</span> <span class="n">p</span><span class="p">);</span>
</pre></div>


<p>The standard-library specification of <code>sort</code> offers those two versions,
but the semantics is expressed in English rather than code using concepts.</p>
<h5 id="note_6">Note</h5>
<p>Premature optimization is said to be <a href="#Rper-Knuth">the root of all evil</a>, but that's not a reason to despise performance.
It is never premature to consider what makes a design amenable to improvement, and improved performance is a commonly desired improvement.
Aim to build a set of habits that by default results in efficient, maintainable, and optimizable code.
In particular, when you write a function that is not a one-off implementation detail, consider</p>
<ul>
<li>Information passing:
Prefer clean <a href="#S-interfaces">interfaces</a> carrying sufficient information for later improvement of implementation.
Note that information flows into and out of an implementation through the interfaces we provide.</li>
<li>Compact data: By default, <a href="#Rper-compact">use compact data</a>, such as <code>std::vector</code> and <a href="#Rper-access">access it in a systematic fashion</a>.
If you think you need a linked structure, try to craft the interface so that this structure isn't seen by users.</li>
<li>Function argument passing and return:
Distinguish between mutable and non-mutable data.
Don't impose a resource management burden on your users.
Don't impose spurious run-time indirections on your users.
Use <a href="#Rf-conventional">conventional ways</a> of passing information through an interface;
unconventional and/or "optimized" ways of passing data can seriously complicate later reimplementation.</li>
<li>Abstraction:
Don't overgeneralize; a design that tries to cater for every possible use (and misuse) and defers every design decision for later
(using compile-time or run-time indirections) is usually a complicated, bloated, hard-to-understand mess.
Generalize from concrete examples, preserving performance as we generalize.
Do not generalize based on mere speculation about future needs.
The ideal is zero-overhead generalization.</li>
<li>Libraries:
Use libraries with good interfaces.
If no library is available build one yourself and imitate the interface style from a good library.
The <a href="#S-stdlib">standard library</a> is a good first place to look for inspiration.</li>
<li>Isolation:
Isolate your code from messy and/or old-style code by providing an interface of your choosing to it.
This is sometimes called "providing a wrapper" for the useful/necessary but messy code.
Don't let bad designs "bleed into" your code.</li>
</ul>
<h5 id="example_1">Example</h5>
<p>Consider:</p>
<div class="codehilite"><pre><span></span>    <span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">ForwardIterator</span><span class="p">,</span> <span class="k">class</span> <span class="nc">T</span><span class="o">&gt;</span>
    <span class="kt">bool</span> <span class="n">binary_search</span><span class="p">(</span><span class="n">ForwardIterator</span> <span class="n">first</span><span class="p">,</span> <span class="n">ForwardIterator</span> <span class="n">last</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">val</span><span class="p">);</span>
</pre></div>


<p><code>binary_search(begin(c), end(c), 7)</code> will tell you whether <code>7</code> is in <code>c</code> or not.
However, it will not tell you where that <code>7</code> is or whether there are more than one <code>7</code>.</p>
<p>Sometimes, just passing the minimal amount of information back (here, <code>true</code> or <code>false</code>) is sufficient, but a good interface passes
needed information back to the caller. Therefore, the standard library also offers</p>
<div class="codehilite"><pre><span></span>    <span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">ForwardIterator</span><span class="p">,</span> <span class="k">class</span> <span class="nc">T</span><span class="o">&gt;</span>
    <span class="n">ForwardIterator</span> <span class="n">lower_bound</span><span class="p">(</span><span class="n">ForwardIterator</span> <span class="n">first</span><span class="p">,</span> <span class="n">ForwardIterator</span> <span class="n">last</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">val</span><span class="p">);</span>
</pre></div>


<p><code>lower_bound</code> returns an iterator to the first match if any, otherwise to the first element greater than <code>val</code>, or <code>last</code> if no such element is found.</p>
<p>However, <code>lower_bound</code> still doesn't return enough information for all uses, so the standard library also offers</p>
<div class="codehilite"><pre><span></span>    <span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">ForwardIterator</span><span class="p">,</span> <span class="k">class</span> <span class="nc">T</span><span class="o">&gt;</span>
    <span class="n">pair</span><span class="o">&lt;</span><span class="n">ForwardIterator</span><span class="p">,</span> <span class="n">ForwardIterator</span><span class="o">&gt;</span>
    <span class="n">equal_range</span><span class="p">(</span><span class="n">ForwardIterator</span> <span class="n">first</span><span class="p">,</span> <span class="n">ForwardIterator</span> <span class="n">last</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">val</span><span class="p">);</span>
</pre></div>


<p><code>equal_range</code> returns a <code>pair</code> of iterators specifying the first and one beyond last match.</p>
<div class="codehilite"><pre><span></span>    <span class="k">auto</span> <span class="n">r</span> <span class="o">=</span> <span class="n">equal_range</span><span class="p">(</span><span class="n">begin</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="n">end</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="mi">7</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">p</span> <span class="o">=</span> <span class="n">r</span><span class="p">.</span><span class="n">first</span><span class="p">();</span> <span class="n">p</span> <span class="o">!=</span> <span class="n">r</span><span class="p">.</span><span class="n">second</span><span class="p">(),</span> <span class="o">++</span><span class="n">p</span><span class="p">)</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="o">*</span><span class="n">p</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
</pre></div>


<p>Obviously, these three interfaces are implemented by the same basic code.
They are simply three ways of presenting the basic binary search algorithm to users,
ranging from the simplest ("make simple things simple!")
to returning complete, but not always needed, information ("don't hide useful information").
Naturally, crafting such a set of interfaces requires experience and domain knowledge.</p>
<h5 id="note_7">Note</h5>
<p>Do not simply craft the interface to match the first implementation and the first use case you think of.
Once your first initial implementation is complete, review it; once you deploy it, mistakes will be hard to remedy.</p>
<h5 id="note_8">Note</h5>
<p>A need for efficiency does not imply a need for <a href="#Rper-low">low-level code</a>.
High-level code does not imply slow or bloated.</p>
<h5 id="note_9">Note</h5>
<p>Things have costs.
Don't be paranoid about costs (modern computers really are very fast),
but have a rough idea of the order of magnitude of cost of what you use.
For example, have a rough idea of the cost of
a memory access,
a function call,
a string comparison,
a system call,
a disk access,
and a message through a network.</p>
<h5 id="note_10">Note</h5>
<p>If you can only think of one implementation, you probably don't have something for which you can devise a stable interface.
Maybe, it is just an implementation detail - not every piece of code needs a stable interface - but pause and consider.
One question that can be useful is
"what interface would be needed if this operation should be implemented using multiple threads? be vectorized?"</p>
<h5 id="note_11">Note</h5>
<p>This rule does not contradict the <a href="#Rper-Knuth">Don't optimize prematurely</a> rule.
It complements it encouraging developers enable later - appropriate and non-premature - optimization, if and where needed.</p>
<h5 id="enforcement">Enforcement</h5>
<p>Tricky.
Maybe looking for <code>void*</code> function arguments will find examples of interfaces that hinder later optimization.</p>
<h3 id="per10"><a name="Rper-type"></a>Per.10: 정적 타입 시스템에 의지하라</h3>
<h5 id="reason_7">Reason</h5>
<p>Type violations, weak types (e.g. <code>void*</code>s), and low-level code (e.g., manipulation of sequences as individual bytes) make the job of the optimizer much harder. Simple code often optimizes better than hand-crafted complex code.</p>
<p>???</p>
<h3 id="per11"><a name="Rper-Comp"></a>Per.11: 계산을 실행 시간에서 컴파일 시간으로 옮겨라</h3>
<h5 id="reason_8">Reason</h5>
<p>To decrease code size and run time.
To avoid data races by using constants.
To catch errors at compile time (and thus eliminate the need for error-handling code).</p>
<h5 id="example_2">Example</h5>
<div class="codehilite"><pre><span></span>    <span class="kt">double</span> <span class="nf">square</span><span class="p">(</span><span class="kt">double</span> <span class="n">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">d</span><span class="o">*</span><span class="n">d</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">static</span> <span class="kt">double</span> <span class="n">s2</span> <span class="o">=</span> <span class="n">square</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>    <span class="c1">// old-style: dynamic initialization</span>

    <span class="k">constexpr</span> <span class="kt">double</span> <span class="nf">ntimes</span><span class="p">(</span><span class="kt">double</span> <span class="n">d</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span>   <span class="c1">// assume 0 &lt;= n</span>
    <span class="p">{</span>
            <span class="kt">double</span> <span class="n">m</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">n</span><span class="o">--</span><span class="p">)</span> <span class="n">m</span> <span class="o">*=</span> <span class="n">d</span><span class="p">;</span>
            <span class="k">return</span> <span class="n">m</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">constexpr</span> <span class="kt">double</span> <span class="n">s3</span> <span class="p">{</span><span class="n">ntimes</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)};</span>  <span class="c1">// modern-style: compile-time initialization</span>
</pre></div>


<p>Code like the initialization of <code>s2</code> isn't uncommon, especially for initialization that's a bit more complicated than <code>square()</code>.
However, compared to the initialization of <code>s3</code> there are two problems:</p>
<ul>
<li>we suffer the overhead of a function call at run time</li>
<li><code>s2</code> just might be accessed by another thread before the initialization happens.</li>
</ul>
<p>Note: you can't have a data race on a constant.</p>
<h5 id="example_3">Example</h5>
<p>Consider a popular technique for providing a handle for storing small objects in the handle itself and larger ones on the heap.</p>
<div class="codehilite"><pre><span></span>    <span class="k">constexpr</span> <span class="kt">int</span> <span class="n">on_stack_max</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
    <span class="k">struct</span> <span class="n">Scoped</span> <span class="p">{</span>     <span class="c1">// store a T in Scoped</span>
            <span class="c1">// ...</span>
        <span class="n">T</span> <span class="n">obj</span><span class="p">;</span>
    <span class="p">};</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
    <span class="k">struct</span> <span class="n">On_heap</span> <span class="p">{</span>    <span class="c1">// store a T on the free store</span>
            <span class="c1">// ...</span>
            <span class="n">T</span><span class="o">*</span> <span class="n">objp</span><span class="p">;</span>
    <span class="p">};</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
    <span class="k">using</span> <span class="n">Handle</span> <span class="o">=</span> <span class="k">typename</span> <span class="n">std</span><span class="o">::</span><span class="n">conditional</span><span class="o">&lt;</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">T</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">on_stack_max</span><span class="p">),</span>
                        <span class="n">Scoped</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">,</span>      <span class="c1">// first alternative</span>
                        <span class="n">On_heap</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span>      <span class="c1">// second alternative</span>
                   <span class="o">&gt;::</span><span class="n">type</span><span class="p">;</span>

    <span class="kt">void</span> <span class="nf">f</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">Handle</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">v1</span><span class="p">;</span>                   <span class="c1">// the double goes on the stack</span>
        <span class="n">Handle</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span> <span class="mi">200</span><span class="o">&gt;&gt;</span> <span class="n">v2</span><span class="p">;</span>  <span class="c1">// the array goes on the free store</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
</pre></div>


<p>Assume that <code>Scoped</code> and <code>On_heap</code> provide compatible user interfaces.
Here we compute the optimal type to use at compile time.
There are similar techniques for selecting the optimal function to call.</p>
<h5 id="note_12">Note</h5>
<p>The ideal is {not} to try execute everything at compile time.
Obviously, most computations depend on inputs so they can't be moved to compile time,
but beyond that logical constraint is the fact that complex compile-time computation can seriously increase compile times
and complicate debugging.
It is even possible to slow down code by compile-time computation.
This is admittedly rare, but by factoring out a general computation into separate optimal sub-calculations it is possible to render the instruction cache less effective.</p>
<h5 id="enforcement_1">Enforcement</h5>
<ul>
<li>Look for simple functions that might be constexpr (but are not).</li>
<li>Look for functions called with all constant-expression arguments.</li>
<li>Look for macros that could be constexpr.</li>
</ul>
<h3 id="per12"><a name="Rper-alias"></a>Per.12: 불필요한 별칭을 제거하라</h3>
<p>???</p>
<h3 id="per13-indirection"><a name="Rper-indirect"></a>Per.13: 불필요한 간접 접근(indirection)을 제거하라</h3>
<p>???</p>
<h3 id="per14"><a name="Rper-alloc"></a>Per.14: 할당과 해제의 수를 최소화하라</h3>
<p>???</p>
<h3 id="per15"><a name="Rper-alloc0"></a>Per.15: 중요 분기에서는 할당을 하지 마라</h3>
<p>???</p>
<h3 id="per16"><a name="Rper-compact"></a>Per.16: 압축적인 자료 구조를 사용하라</h3>
<h5 id="reason_9">Reason</h5>
<p>보통 성능은 메모리 접근시간에 반비례한다.</p>
<p>???</p>
<h3 id="per17"><a name="Rper-struct"></a>Per.17: 빠른 처리를 요구하는 구조체에서 가장 많이 쓰이는 멤버를 먼저 선언해라</h3>
<p>???</p>
<h3 id="per18"><a name="Rper-space"></a>Per.18: 공간은 시간이다</h3>
<h5 id="reason_10">Reason</h5>
<p>보통 성능은 메모리 접근시간에 반비례한다.</p>
<p>???</p>
<h3 id="per19"><a name="Rper-access"></a>Per.19: 예측할 수 있는 메모리 접근을 해라</h3>
<h5 id="reason_11">Reason</h5>
<p>Performance is very sensitive to cache performance and cache algorithms favor simple (usually linear) access to adjacent data.</p>
<h5 id="example_4">Example</h5>
<div class="codehilite"><pre><span></span>    <span class="kt">int</span> <span class="n">matrix</span><span class="p">[</span><span class="n">rows</span><span class="p">][</span><span class="n">cols</span><span class="p">];</span>

    <span class="c1">// bad</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">c</span> <span class="o">&lt;</span> <span class="n">cols</span><span class="p">;</span> <span class="o">++</span><span class="n">c</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">r</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="n">rows</span><span class="p">;</span> <span class="o">++</span><span class="n">r</span><span class="p">)</span>
            <span class="n">sum</span> <span class="o">+=</span> <span class="n">matrix</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">];</span>

    <span class="c1">// good</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">r</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="n">rows</span><span class="p">;</span> <span class="o">++</span><span class="n">r</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">c</span> <span class="o">&lt;</span> <span class="n">cols</span><span class="p">;</span> <span class="o">++</span><span class="n">c</span><span class="p">)</span>
            <span class="n">sum</span> <span class="o">+=</span> <span class="n">matrix</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">];</span>
</pre></div>


<h3 id="per30"><a name="Rper-context"></a>Per.30: 중요 경로에서 문맥전환을 피하라</h3>
<p>???</p>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../Not/" title="Not-Rule" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Not-Rule
              </span>
            </div>
          </a>
        
        
          <a href="../Philosophy/" title="Philosophy" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Philosophy
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright (c) Standard C++ Foundation and its contributors
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.808e90bb.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>